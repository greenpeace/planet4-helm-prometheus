---
additionalPrometheusRulesMap:
  planet4:
    groups:
      - name: p4_websites
        rules:
          - alert: ProbeFailed
            annotations:
              description: |
                {{$labels.instance}} has not responded to a ping for the last 5m
              observability_url: >-
                https://grafana.greenpeace.org/d/_nw9AwwMz/probe-monitoring-global?orgId=1&var-target={{$labels.instance}}
              runbook_url: >-
                https://docs.google.com/document/d/1YgbkEDgENyxJ67QZ5VeVTh-uZfv8UCKvDGv553CvqBQ/edit#bookmark=id.475lqkazle41
              summary: '{{$labels.instance}} not responding'
              gitlab_incident_markdown: |
                /label  ~\"Terraform Deployment\"\n Probe failed
            expr: |
              probe_success == 0
            for: 2m
            labels:
              email_contact: global-it-operations@greenpeace.org
              gitlab_project: planet4-documentation-and-issues
              severity: warning
              slack_channel: p4-slack-alert
          - alert: SlowProbe
            annotations:
              description: |-
                '{{$labels.instance}} probe is taking longer than 2.5s'
              observability_url: >-
                https://grafana.greenpeace.org/d/_nw9AwwMz/probe-monitoring-global?orgId=1&var-target={{$labels.instance}}
              runbook_url: >-
                https://docs.google.com/document/d/1YgbkEDgENyxJ67QZ5VeVTh-uZfv8UCKvDGv553CvqBQ/edit#bookmark=id.9as4myvdzik2
              summary: '{{$labels.instance}} responding slowly'
              gitlab_incident_markdown: |
                /label  ~\"Terraform Deployment\"\n Probe slow
            expr: |
              avg_over_time(probe_duration_seconds[1m]) > 2.5
            for: 2m
            labels:
              email_contact: global-it-operations@greenpeace.org
              gitlab_project: planet4-documentation-and-issues
              severity: warning
              slack_channel: p4-slack-alert
          - alert: HttpStatusCode
            annotations:
              description: '{{$labels.instance}} probe is taking longer than 2s'
              observability_url: >-
                https://grafana.greenpeace.org/d/_nw9AwwMz/probe-monitoring-global?orgId=1&var-target={{$labels.instance}}
              runbook_url: >-
                https://docs.google.com/document/d/1YgbkEDgENyxJ67QZ5VeVTh-uZfv8UCKvDGv553CvqBQ/edit#bookmark=id.xorjr89c765l
              summary: '{{$labels.instance}} responding slowly'
              gitlab_incident_markdown: |
                /label  ~\"Terraform Deployment\"\n HTTP probe failed
            expr: |
              probe_http_status_code <= 199 OR probe_http_status_code >= 400
            for: 5m
            labels:
              email_contact: global-it-operations@greenpeace.org
              gitlab_project: planet4-documentation-and-issues
              severity: warning
              slack_channel: p4-slack-alert
          - alert: HttpSlowRequests
            annotations:
              description: '{{$labels.instance}} probe is taking longer than 2s'
              observability_url: >-
                https://grafana.greenpeace.org/d/_nw9AwwMz/probe-monitoring-global?orgId=1&var-target={{$labels.instance}}
              runbook_url: >-
                https://docs.google.com/document/d/1YgbkEDgENyxJ67QZ5VeVTh-uZfv8UCKvDGv553CvqBQ/edit#bookmark=id.89vqtjr3cb8p
              summary: '{{$labels.instance}} responding slowly'
              gitlab_incident_markdown: |
                 /label  ~\"Terraform Deployment\"\n HTTP probe slow
            expr: |
              avg_over_time(probe_http_duration_seconds[1m]) > 2
            for: 5m
            labels:
              email_contact: global-it-operations@greenpeace.org
              gitlab_project: planet4-documentation-and-issues
              severity: warning
              slack_channel: p4-slack-alert
